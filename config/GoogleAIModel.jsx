const {
    GoogleGenerativeAI,
    HarmCategory,
    HarmBlockThreshold,
  } = require("@google/generative-ai");
  
  const apiKey = process.env.NEXT_PUBLIC_GEMINI_API_KEY;
  const genAI = new GoogleGenerativeAI(apiKey);
  
  const model = genAI.getGenerativeModel({
    model: "gemini-1.5-flash",
  });
  
  const generationConfig = {
    temperature: 1,
    topP: 0.95,
    topK: 40,
    maxOutputTokens: 8192,
    responseMimeType: "application/json",
  };
  
    export const chatSession = model.startChat({
      generationConfig,
      history: [
        {
          role: "user",
          parts: [
            {text: "You are an AI language model that generates JSON representations of documents in a specific format compatible with Editor.js. The JSON should adhere to the following structure:\n\njson\nCopy code\n{\n  \"time\": [current timestamp in milliseconds],\n  \"blocks\": [\n    // Blocks go here\n  ],\n  \"version\": \"2.8.1\"\n}\nBlock Types and Their Structures:\n\nHeader Block:\n\njson\nCopy code\n{\n  \"type\": \"header\",\n  \"data\": {\n    \"text\": \"[Header text here]\",\n    \"level\": [Header level (1-6)]\n  }\n}\nParagraph Block:\n\njson\nCopy code\n{\n  \"type\": \"paragraph\",\n  \"data\": {\n    \"text\": \"[Paragraph text here]\"\n  }\n}\nImage Block:\n\njson\nCopy code\n{\n  \"type\": \"image\",\n  \"data\": {\n    \"file\": {\n      \"url\": \"[Image URL here]\"\n    },\n    \"caption\": \"[Image caption here]\",\n    \"withBorder\": false,\n    \"stretched\": false,\n    \"withBackground\": false\n  }\n}\nTable Block:\n\njson\nCopy code\n{\n  \"type\": \"table\",\n  \"data\": {\n    \"content\": [\n      [\"[Row1, Column1]\", \"[Row1, Column2]\", \"...\"],\n      [\"[Row2, Column1]\", \"[Row2, Column2]\", \"...\"],\n      // More rows as needed\n    ]\n  }\n}\nList Block:\n\nImportant: For list blocks, the \"items\" array must contain strings only, not objects.\njson\nCopy code\n{\n  \"type\": \"list\",\n  \"data\": {\n    \"style\": \"[unordered|ordered]\",\n    \"items\": [\n      \"[First list item]\",\n      \"[Second list item]\",\n      // More items as needed\n    ]\n  }\n}\nChecklist Block:\n\njson\nCopy code\n{\n  \"type\": \"checklist\",\n  \"data\": {\n    \"items\": [\n      {\n        \"text\": \"[First checklist item]\",\n        \"checked\": [true|false]\n      },\n      // More items as needed\n    ]\n  }\n}\nCode Block:\n\njson\nCopy code\n{\n  \"type\": \"code\",\n  \"data\": {\n    \"code\": \"[Code snippet here]\"\n  }\n}\nQuote Block:\n\njson\nCopy code\n{\n  \"type\": \"quote\",\n  \"data\": {\n    \"text\": \"[Quote text here]\",\n    \"caption\": \"[Quote caption or author]\",\n    \"alignment\": \"[left|center]\"\n  }\n}\nInstructions:\n\nContent Generation: Based on the input provided, generate detailed and informative text suitable for educational and professional office documents.\nStructure: Organize the content into appropriate blocks as defined above.\nHeaders: Use header blocks to denote sections and subsections. Specify the header level (1-6) accordingly.\nParagraphs: Use paragraph blocks for regular text content.\nImages: Include image blocks when visual representation enhances understanding. Provide a placeholder URL or description if necessary.\nTables: Use table blocks to present data in a structured format when needed.\nLists: For list blocks, ensure that the \"items\" array contains strings only, representing each list item.\nOther Blocks: Include other block types as appropriate to enrich the content.\nFormatting: Ensure that the text within each block is well-formatted, clear, and coherent.\nMetadata:\nThe \"time\" field should be the current timestamp in milliseconds.\nThe \"version\" field should be \"2.8.1\".\nExample Input:\n\n\"Create a comprehensive report on the impact of renewable energy adoption worldwide, including key statistics, trends, images illustrating different renewable technologies, and a comparison table of renewable energy output by country.\"\n\nExpected Output Format:\n\njson\nCopy code\n{\n  \"time\": 1700000000000,\n  \"blocks\": [\n    {\n      \"type\": \"header\",\n      \"data\": {\n        \"text\": \"The Impact of Renewable Energy Adoption Worldwide\",\n        \"level\": 1\n      }\n    },\n    {\n      \"type\": \"paragraph\",\n      \"data\": {\n        \"text\": \"Renewable energy has seen significant growth over the past decade, driven by concerns about climate change and advancements in technology.\"\n      }\n    },\n    {\n      \"type\": \"image\",\n      \"data\": {\n        \"file\": {\n          \"url\": \"https://example.com/solar_panels.jpg\"\n        },\n        \"caption\": \"Solar panels in a vast solar farm.\",\n        \"withBorder\": false,\n        \"stretched\": false,\n        \"withBackground\": false\n      }\n    },\n    {\n      \"type\": \"header\",\n      \"data\": {\n        \"text\": \"Key Statistics and Trends\",\n        \"level\": 2\n      }\n    },\n    {\n      \"type\": \"list\",\n      \"data\": {\n        \"style\": \"unordered\",\n        \"items\": [\n          \"Global renewable energy capacity reached 2,800 GW in 2021.\",\n          \"Renewables accounted for 29% of global electricity generation.\",\n          \"Investment in renewable energy exceeded $300 billion annually.\"\n        ]\n      }\n    },\n    {\n      \"type\": \"table\",\n      \"data\": {\n        \"content\": [\n          [\"Country\", \"Renewable Output (GW)\"],\n          [\"China\", \"1,200\"],\n          [\"United States\", \"350\"],\n          [\"Germany\", \"200\"]\n        ]\n      }\n    },\n    {\n      \"type\": \"paragraph\",\n      \"data\": {\n        \"text\": \"As illustrated in the table above, China leads the world in renewable energy production.\"\n      }\n    },\n    // Additional blocks as needed\n  ],\n  \"version\": \"2.8.1\"\n}\nGuidelines:\n\nList Handling:\nWhen creating list blocks, ensure that the \"items\" array contains strings only.\nExample of a correct list block:\njson\nCopy code\n{\n  \"type\": \"list\",\n  \"data\": {\n    \"style\": \"ordered\",\n    \"items\": [\n      \"First item\",\n      \"Second item\",\n      \"Third item\"\n    ]\n  }\n}\nDo not include objects or nested arrays within the \"items\" array.\nConsistency: Maintain consistency in formatting and data structures throughout the document.\nCompleteness: Include all relevant information as per the input prompt, utilizing various block types appropriately.\nValidation: Ensure that the JSON output is valid and properly structured."},
          ],
        },
        {
          role: "model",
          parts: [
            {text: "```json\n{\n  \"time\": 1701188446000,\n  \"blocks\": [\n    {\n      \"type\": \"header\",\n      \"data\": {\n        \"text\": \"The Impact of Renewable Energy Adoption Worldwide\",\n        \"level\": 1\n      }\n    },\n    {\n      \"type\": \"paragraph\",\n      \"data\": {\n        \"text\": \"Renewable energy sources have witnessed remarkable growth in recent years, driven by mounting concerns regarding climate change and the continuous advancements in renewable energy technologies. The transition towards a more sustainable future relies heavily on harnessing the power of the sun, wind, and other renewable resources.\"\n      }\n    },\n    {\n      \"type\": \"image\",\n      \"data\": {\n        \"file\": {\n          \"url\": \"https://example.com/wind_turbines.jpg\"\n        },\n        \"caption\": \"Wind turbines generating clean energy.\",\n        \"withBorder\": false,\n        \"stretched\": false,\n        \"withBackground\": false\n      }\n    },\n    {\n      \"type\": \"header\",\n      \"data\": {\n        \"text\": \"Key Statistics and Trends\",\n        \"level\": 2\n      }\n    },\n    {\n      \"type\": \"paragraph\",\n      \"data\": {\n        \"text\": \"The global renewable energy sector has demonstrated impressive progress, achieving significant milestones in recent years.  Here are some key statistics and trends that highlight the impact of renewable energy adoption worldwide.\"\n      }\n    },\n    {\n      \"type\": \"list\",\n      \"data\": {\n        \"style\": \"unordered\",\n        \"items\": [\n          \"Global renewable energy capacity surpassed 3,000 GW in 2022.\",\n          \"Renewables contributed to over 30% of global electricity generation, a significant increase compared to previous years.\",\n          \"Investment in renewable energy technologies has exceeded $350 billion annually, reflecting a strong commitment to sustainable energy solutions.\"\n        ]\n      }\n    },\n    {\n      \"type\": \"header\",\n      \"data\": {\n        \"text\": \"Renewable Energy Output by Country\",\n        \"level\": 3\n      }\n    },\n    {\n      \"type\": \"table\",\n      \"data\": {\n        \"content\": [\n          [\"Country\", \"Renewable Output (GW)\"],\n          [\"China\", \"1,400\"],\n          [\"United States\", \"400\"],\n          [\"Germany\", \"250\"],\n          [\"India\", \"150\"],\n          [\"Brazil\", \"120\"]\n        ]\n      }\n    },\n    {\n      \"type\": \"paragraph\",\n      \"data\": {\n        \"text\": \"As illustrated in the table, China continues to lead the world in renewable energy production, demonstrating a strong commitment to sustainable energy sources. However, other countries are also making significant strides in harnessing renewable energy, contributing to a global shift towards cleaner energy solutions.\"\n      }\n    },\n    {\n      \"type\": \"header\",\n      \"data\": {\n        \"text\": \"Challenges and Opportunities\",\n        \"level\": 2\n      }\n    },\n    {\n      \"type\": \"paragraph\",\n      \"data\": {\n        \"text\": \"While renewable energy adoption presents a promising path towards a sustainable future, it also comes with certain challenges. Integrating renewable energy sources into existing energy grids, ensuring grid stability, and managing intermittency of renewable energy sources are key issues that need to be addressed. Nevertheless, these challenges are being actively tackled through technological advancements, policy initiatives, and international cooperation.\"\n      }\n    },\n    {\n      \"type\": \"paragraph\",\n      \"data\": {\n        \"text\": \"Despite the challenges, the global renewable energy sector offers numerous opportunities. Continued technological innovation, cost reductions, and increased investment in renewable energy infrastructure are driving further growth. Additionally, the development of new energy storage technologies, such as battery storage, is crucial for overcoming the intermittency challenges associated with renewable energy sources.\"\n      }\n    },\n    {\n      \"type\": \"header\",\n      \"data\": {\n        \"text\": \"Conclusion\",\n        \"level\": 2\n      }\n    },\n    {\n      \"type\": \"paragraph\",\n      \"data\": {\n        \"text\": \"The global adoption of renewable energy is a significant step towards a sustainable future. The increasing investment, technological advancements, and growing awareness of climate change are driving the transition to cleaner energy sources. While challenges exist, the opportunities presented by renewable energy are substantial, paving the way for a greener and more sustainable future.\"\n      }\n    }\n  ],\n  \"version\": \"2.8.1\"\n}\n```"},
          ],
        },
      ],
    });